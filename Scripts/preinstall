#!/bin/sh

set -eux

cd "$(pwd)"

DB_PASSWORD="$(uuidgen)"
if ! grep -q "^export DB_PASSWORD=" ./config.sh; then
    echo "export DB_PASSWORD=\"$DB_PASSWORD\"" >> ./config.sh
fi

# shellcheck disable=SC1091
. ./config.sh

install_logfile="/tmp/immich-install.log"
./createlog.sh "$install_logfile"
{
    ./installdependencies.sh
    ./configurepostgres.sh "$DB_PASSWORD"
} 2>&1 | tee -a "$install_logfile"
